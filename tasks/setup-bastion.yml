# Params bastion settings

- name: Create bastion directory
  file:
    path: "{{ bastion_shell_path }}"
    owner: "{{ bastion_user }}"
    group: "{{ bastion_group }}"
    state: directory

- name: Set file for log all command with selinux
  template:
    src: shell.j2
    dest: "{{ bastion_shell_path }}/shell"
    owner: "{{ bastion_user }}"
    group: "{{ bastion_group }}"
    mode: 0755

- name: Params sshd for log all commandes
  lineinfile:
    path: "{{ sshd_path }}"
    regexp: '^ForceCommand'
    line: 'ForceCommand /usr/bin/bastion/shell'
  notify: restart sshd

- name: Disable tcp forwarding
  lineinfile:
    path: "{{ sshd_path }}"
    regexp: '^AllowTcpForwarding'
    line: 'AllowTcpForwarding no'
  notify: restart sshd

- name: Disable x11 forwarding
  lineinfile:
    path: "{{ sshd_path }}"
    regexp: '^X11Forwarding'
    line: 'X11Forwarding no'
  notify: restart sshd
